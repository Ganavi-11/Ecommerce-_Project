<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ecommerce</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link rel="stylesheet" href="./home.css"/>  
</head>

<body>
  <header>
    <div class="logo"><a href="./home.html">Ecommerce</a></div>

    <nav>
      <a href="./home.html">Home</a>
      <a href="./products.html">Products</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
    </nav>

    <div class="header-actions">
      <a href="./login.html"><i class="fa fa-user"></i> Login</a>
      <a href="./register.html"><i class="fa fa-user-plus"></i> Register</a>
      <a href="./cart.html" id="cartLink"><i class="fa fa-shopping-cart"></i> Cart (0)</a>
    </div>

    <div class="hamburger" id="hamburger">
      <i class="fa fa-bars"></i>
    </div>
  </header>

  <div class="container">
    <div class="mobile-menu" id="mobileMenu">
      <a href="./home.html">Home</a>
      <a href="./products.html">Products</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a href="./login.html"><i class="fa fa-user"></i> Login</a>
      <a href="./register.html"><i class="fa fa-user-plus"></i> Register</a>
      <a href="./cart.html" id="cartLinkMobile"><i class="fa fa-shopping-cart"></i> Cart (0)</a>
    </div>
    <!-- Banner -->
    <div class="banner">
      <img src="./assets/main.png.jpg" />
      <div class="overlay"></div>
      <div class="banner-text">
        <h1>New Season Arrivals</h1>
        <p>
          This is a wider card with supporting text below as a natural lead-in
          to additional content.
        </p>
      </div>
    </div>

    <!-- PRODUCTS -->
    <div class="Products">
      <h2>Latest Products</h2>
      <hr>

      <div class="filterButtons">
        <button class="active">All</button>
        <button>Men's Clothing</button>
        <button>Women's Clothing</button>
        <button>Jewelery</button>
        <button>Electronics</button>
      </div>

      <div class="products-grid" id="productGrid">
        <p>Loading....</p>
      </div>
    </div>

  </div>

  <footer>
    <p>Made with ❤️ by <span>Ganavi</span></p>
  </footer>

  <script>

    const grid = document.getElementById("productGrid");
    const buttons = document.querySelectorAll(".filterButtons button");
    let allProducts = [];

    const shorten = (text, n) => {
      return text.length > n ? text.slice(0, n) + "..." : text;
    };

    // Hamburger menu toggle
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');

    hamburger.addEventListener('click', () => {
      mobileMenu.classList.toggle('active');
    });

    // Hide mobile menu on resize to desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth > 768) {
        mobileMenu.classList.remove('active');
      }
    });

    async function getProducts() {
      const res = await fetch("https://fakestoreapi.com/products");
      allProducts = await res.json();
      display(allProducts);
    }

    function display(products) {
      grid.innerHTML = "";

      products.slice(0, 18).forEach((item, index) => {
        grid.innerHTML += `
          <div class="product-card">
            <div class="image-wrap">
              <img src="${item.image}">
            </div>
            <h4>${shorten(item.title, 30)}</h4>
            <p>${shorten(item.description, 70)}</p>
            <div class="price">$ ${item.price}</div>
            <div class="btns">
              <button onclick="showDetails(${item.id})">Details</button>
              <button onclick="addToCart(${item.id}, '${item.title}', '${item.image}', ${item.price})">Add To Cart</button>
            </div>
          </div>
        `;
      });
    }

    buttons.forEach((btn) => {
      btn.onclick = () => {
        buttons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        const map = {
          "Men's Clothing": "men's clothing",
          "Women's Clothing": "women's clothing",
          Jewelery: "jewelery",
          Electronics: "electronics",
          All: "all",
        };

        if (btn.textContent === "All") {
          display(allProducts);
        } else {
          const filtered = allProducts.filter(
            (p) => p.category === map[btn.textContent]
          );
          display(filtered);
        }
      };
    });

    getProducts();

    // Function part for  update cart counter

    function updateCartCounter() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
      const cartLink = document.getElementById('cartLink');
      if (cartLink) {
        cartLink.innerHTML = `<i class="fa fa-shopping-cart"></i> Cart (${totalItems})`;
      }
    }

    // Update cart counter 

    document.addEventListener('DOMContentLoaded', updateCartCounter);

    // Function to add item to cart
    function addToCart(id, title, image, price) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existingItem = cart.find(item => item.id === id);
      if (existingItem) {
        existingItem.qty += 1;
      } else {
        cart.push({ id, title, image, price, qty: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCounter();
      alert(`${title} added to cart!`);
    }

    // Function to show details 
    function showDetails(id) {
      alert(`Details for product ID: ${id}`);
    }
  </script>
</body>

</html>